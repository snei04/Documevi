{
  "info": {
    "name": "Documevi API",
    "description": "Sistema de Gesti√≥n Documental IMEVI - Colecci√≥n completa de endpoints de la API.\n\n## Autenticaci√≥n\nLa mayor√≠a de endpoints requieren autenticaci√≥n Bearer Token. Usa el endpoint Login para obtener el token.\n\n## Variables\n- `baseUrl`: URL base de la API (default: http://localhost:4000/api)\n- `token`: Token JWT de autenticaci√≥n\n\n## M√≥dulos\n- Auth: Autenticaci√≥n y gesti√≥n de sesi√≥n\n- Usuarios: Gesti√≥n de usuarios y perfiles\n- Documentos: Gesti√≥n documental y workflows",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "1.0.0"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:4000/api",
      "type": "string",
      "description": "URL base de la API"
    },
    {
      "key": "token",
      "value": "",
      "type": "string",
      "description": "Token JWT de autenticaci√≥n (se obtiene del Login)"
    }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{token}}",
        "type": "string"
      }
    ]
  },
  "item": [
    {
      "name": "üîê Auth",
      "description": "Endpoints de autenticaci√≥n: registro, login, logout y recuperaci√≥n de contrase√±a.",
      "item": [
        {
          "name": "Register User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nombre_completo\": \"Juan P√©rez\",\n  \"email\": \"juan@example.com\",\n  \"documento\": \"12345678\",\n  \"password\": \"password123\",\n  \"rol_id\": 1\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            },
            "description": "Registra un nuevo usuario en el sistema. Requiere permisos de administrador.\n\n**Campos requeridos:**\n- `nombre_completo`: Nombre completo del usuario\n- `email`: Correo electr√≥nico √∫nico\n- `documento`: Documento de identidad √∫nico\n- `password`: Contrase√±a (m√≠nimo 6 caracteres)\n- `rol_id`: ID del rol a asignar"
          },
          "response": []
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Guardar el token autom√°ticamente en las variables de colecci√≥n",
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.token) {",
                  "        pm.collectionVariables.set('token', jsonData.token);",
                  "        console.log('Token guardado exitosamente');",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"documento\": \"12345678\",\n  \"password\": \"password123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Autentica un usuario y devuelve un token JWT.\n\n**Campos requeridos:**\n- `documento`: Documento de identidad\n- `password`: Contrase√±a\n\n**Response exitosa:**\n- `token`: Token JWT para autenticaci√≥n\n- `user`: Datos del usuario autenticado\n\n‚ö° **Script autom√°tico:** El token se guarda autom√°ticamente en las variables de colecci√≥n."
          },
          "response": []
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "url": {
              "raw": "{{baseUrl}}/auth/logout",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "logout"]
            },
            "description": "Cierra la sesi√≥n del usuario actual y limpia la cookie de autenticaci√≥n."
          },
          "response": []
        },
        {
          "name": "Set Password",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"token_de_invitacion\",\n  \"password\": \"nuevaPassword123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/set-password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "set-password"]
            },
            "description": "Establece la contrase√±a para un usuario invitado usando el token de invitaci√≥n.\n\n**Campos requeridos:**\n- `token`: Token de invitaci√≥n recibido por correo\n- `password`: Nueva contrase√±a (m√≠nimo 6 caracteres)"
          },
          "response": []
        },
        {
          "name": "Get Me",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/auth/me",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "me"]
            },
            "description": "Obtiene los datos del usuario actualmente autenticado.\n\n**Requiere:** Token de autenticaci√≥n v√°lido."
          },
          "response": []
        },
        {
          "name": "Forgot Password",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"usuario@example.com\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/forgot-password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "forgot-password"]
            },
            "description": "Inicia el proceso de recuperaci√≥n de contrase√±a. Env√≠a un correo con enlace de recuperaci√≥n.\n\n**Campos requeridos:**\n- `email`: Correo electr√≥nico registrado\n\n‚ö†Ô∏è Por seguridad, siempre responde con √©xito sin importar si el email existe."
          },
          "response": []
        },
        {
          "name": "Reset Password",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"password\": \"nuevaPassword123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/reset-password/:token",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "reset-password", ":token"],
              "variable": [
                {
                  "key": "token",
                  "value": "",
                  "description": "Token de recuperaci√≥n recibido por correo"
                }
              ]
            },
            "description": "Restablece la contrase√±a usando el token de recuperaci√≥n.\n\n**Par√°metros URL:**\n- `token`: Token de recuperaci√≥n (del enlace del correo)\n\n**Campos requeridos:**\n- `password`: Nueva contrase√±a (m√≠nimo 6 caracteres)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "üë§ Usuarios",
      "description": "Gesti√≥n de usuarios: perfil personal, administraci√≥n de usuarios e invitaciones.",
      "item": [
        {
          "name": "üìã Perfil",
          "description": "Endpoints para gesti√≥n del perfil del usuario autenticado.",
          "item": [
            {
              "name": "Get Profile",
              "request": {
                "method": "GET",
                "url": {
                  "raw": "{{baseUrl}}/usuarios/perfil",
                  "host": ["{{baseUrl}}"],
                  "path": ["usuarios", "perfil"]
                },
                "description": "Obtiene el perfil completo del usuario autenticado, incluyendo sus permisos.\n\n**Response incluye:**\n- Datos personales (id, nombre, email, documento)\n- `permissions`: Array de permisos del usuario"
              },
              "response": []
            },
            {
              "name": "Update Profile",
              "request": {
                "method": "PUT",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"nombre_completo\": \"Juan P√©rez Actualizado\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{baseUrl}}/usuarios/perfil",
                  "host": ["{{baseUrl}}"],
                  "path": ["usuarios", "perfil"]
                },
                "description": "Actualiza el perfil del usuario autenticado.\n\n**Campos editables:**\n- `nombre_completo`: Nombre completo\n\n‚ö†Ô∏è **Restricci√≥n de seguridad:** Email y documento NO son editables por el usuario."
              },
              "response": []
            },
            {
              "name": "Change Password",
              "request": {
                "method": "PUT",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"currentPassword\": \"contrase√±aActual\",\n  \"newPassword\": \"nuevaContrase√±a123\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{baseUrl}}/usuarios/cambiar-password",
                  "host": ["{{baseUrl}}"],
                  "path": ["usuarios", "cambiar-password"]
                },
                "description": "Cambia la contrase√±a del usuario autenticado.\n\n**Campos requeridos:**\n- `currentPassword`: Contrase√±a actual (para verificaci√≥n)\n- `newPassword`: Nueva contrase√±a (m√≠nimo 6 caracteres)"
              },
              "response": []
            }
          ]
        },
        {
          "name": "‚öôÔ∏è Administraci√≥n",
          "description": "Endpoints administrativos para gesti√≥n de usuarios (requieren permisos especiales).",
          "item": [
            {
              "name": "Get All Users",
              "request": {
                "method": "GET",
                "url": {
                  "raw": "{{baseUrl}}/usuarios",
                  "host": ["{{baseUrl}}"],
                  "path": ["usuarios"]
                },
                "description": "Obtiene la lista de todos los usuarios del sistema.\n\n**Requiere permiso:** `usuarios_ver`\n\n**Response incluye:**\n- id, nombre_completo, email, documento, activo, rol"
              },
              "response": []
            },
            {
              "name": "Update User",
              "request": {
                "method": "PUT",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"rol_id\": 2,\n  \"activo\": true\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{baseUrl}}/usuarios/:id",
                  "host": ["{{baseUrl}}"],
                  "path": ["usuarios", ":id"],
                  "variable": [
                    {
                      "key": "id",
                      "value": "1",
                      "description": "ID del usuario a actualizar"
                    }
                  ]
                },
                "description": "Actualiza los datos de un usuario (solo administradores).\n\n**Requiere permiso:** `usuarios_editar`\n\n**Campos editables:**\n- `rol_id`: ID del nuevo rol\n- `activo`: Estado activo/inactivo (boolean)"
              },
              "response": []
            },
            {
              "name": "Invite User",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"nombre_completo\": \"Nuevo Usuario\",\n  \"email\": \"nuevo@example.com\",\n  \"documento\": \"87654321\",\n  \"rol_id\": 2\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{baseUrl}}/usuarios/invite",
                  "host": ["{{baseUrl}}"],
                  "path": ["usuarios", "invite"]
                },
                "description": "Invita a un nuevo usuario enviando un correo con enlace de activaci√≥n.\n\n**Requiere permiso:** `usuarios_crear`\n\n**Campos requeridos:**\n- `nombre_completo`: Nombre completo\n- `email`: Correo electr√≥nico √∫nico\n- `documento`: Documento de identidad √∫nico\n- `rol_id`: ID del rol a asignar\n\nüìß El usuario recibir√° un correo para establecer su contrase√±a."
              },
              "response": []
            }
          ]
        }
      ]
    },
    {
      "name": "üìÑ Documentos",
      "description": "Gesti√≥n documental: captura, workflows, firmas y consultas.",
      "item": [
        {
          "name": "Get All Documents",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/documentos",
              "host": ["{{baseUrl}}"],
              "path": ["documentos"]
            },
            "description": "Obtiene la lista de todos los documentos del sistema.\n\n**Requiere permiso:** `documentos_ver`"
          },
          "response": []
        },
        {
          "name": "Create Document",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "archivo",
                  "type": "file",
                  "src": [],
                  "description": "Archivo del documento (PDF, DOCX, etc.)"
                },
                {
                  "key": "asunto",
                  "value": "Asunto del documento",
                  "type": "text",
                  "description": "Asunto o t√≠tulo del documento"
                },
                {
                  "key": "id_expediente",
                  "value": "1",
                  "type": "text",
                  "description": "ID del expediente al que pertenece (opcional)"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/documentos",
              "host": ["{{baseUrl}}"],
              "path": ["documentos"]
            },
            "description": "Crea un nuevo documento subiendo un archivo.\n\n**Requiere permiso:** `documentos_crear`\n\n**Campos (form-data):**\n- `archivo`: Archivo a subir (requerido)\n- `asunto`: Asunto del documento\n- `id_expediente`: ID del expediente (opcional)"
          },
          "response": []
        },
        {
          "name": "Create Document from Template",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"id_plantilla\": 1,\n  \"id_expediente\": 1,\n  \"variables\": {\n    \"nombre_usuario\": \"Juan P√©rez\",\n    \"fecha\": \"2024-01-15\"\n  }\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/documentos/desde-plantilla",
              "host": ["{{baseUrl}}"],
              "path": ["documentos", "desde-plantilla"]
            },
            "description": "Genera un documento a partir de una plantilla predefinida.\n\n**Requiere permiso:** `documentos_crear`\n\n**Campos requeridos:**\n- `id_plantilla`: ID de la plantilla a usar\n- `id_expediente`: ID del expediente destino\n- `variables`: Objeto con los valores de las variables de la plantilla"
          },
          "response": []
        },
        {
          "name": "Start Workflow",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"id_workflow\": 1\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/documentos/:id/start-workflow",
              "host": ["{{baseUrl}}"],
              "path": ["documentos", ":id", "start-workflow"],
              "variable": [
                {
                  "key": "id",
                  "value": "1",
                  "description": "ID del documento"
                }
              ]
            },
            "description": "Inicia un workflow para un documento espec√≠fico.\n\n**Par√°metros URL:**\n- `id`: ID del documento\n\n**Campos requeridos:**\n- `id_workflow`: ID del workflow a iniciar"
          },
          "response": []
        },
        {
          "name": "Advance Workflow",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"comentario\": \"Aprobado, continuar con el siguiente paso\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/documentos/:id/advance-workflow",
              "host": ["{{baseUrl}}"],
              "path": ["documentos", ":id", "advance-workflow"],
              "variable": [
                {
                  "key": "id",
                  "value": "1",
                  "description": "ID del documento"
                }
              ]
            },
            "description": "Avanza el workflow de un documento al siguiente paso.\n\n**Par√°metros URL:**\n- `id`: ID del documento\n\n**Campos opcionales:**\n- `comentario`: Comentario sobre la acci√≥n realizada"
          },
          "response": []
        },
        {
          "name": "Sign Document",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firma_imagen\": \"data:image/png;base64,iVBORw0KGgo...\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/documentos/:id/firmar",
              "host": ["{{baseUrl}}"],
              "path": ["documentos", ":id", "firmar"],
              "variable": [
                {
                  "key": "id",
                  "value": "1",
                  "description": "ID del documento a firmar"
                }
              ]
            },
            "description": "Firma digitalmente un documento.\n\n**Par√°metros URL:**\n- `id`: ID del documento\n\n**Campos requeridos:**\n- `firma_imagen`: Imagen de la firma en formato base64"
          },
          "response": []
        }
      ]
    }
  ]
}
